import{q as w,f as p,h as f,i as m,j as s,k as c,u as y,S as J,z as I,s as i,T as K,F as q,t as A,D as B,C as Q,B as M,U as W,l as X,V as Z,M as ee,N as te}from"./index-0f2875a4.js";import{_ as se,u as ae,t as ne,a as x,b as j,d as oe}from"./App-fcc1d47e.js";const ce=S=>(ee("data-v-a53b8bd1"),S=S(),te(),S),le={class:"search"},ie={key:0,class:"search-history"},re={class:"title"},de={class:"search-history-box"},ue=["onClick"],pe={class:"text",title:"点击搜索"},_e={class:"search-list"},he=ce(()=>i("p",{class:"title"},"搜索结果：",-1)),ve=["onClick"],fe={title:"立即播放"},ge={class:"search-action"},me=["onClick"],ye=["onClick"],ke=["onClick"],Ce=["onClick"],D=15,we={__name:"MusicSearch",setup(S){const{useMusicStore:l}=ae(),k=w(""),C=w([]),b=w(!1),L=e=>{if(C.value=[],!e){ne({type:"warning",content:"请输入歌曲、歌手后搜索"});return}l.searchHistory.indexOf(e)<0&&l.searchHistory.unshift(e),H(e)};let N=w(1),P=w(!1);const H=e=>{k.value=e,b.value=!0;const t=`https://api.lolimi.cn/API/qqdg/api.php?msg=${e}&p=${N.value}&sc=${D}`;x.get(t).then(a=>{a.data.code===1?(C.value=[...C.value,...a.data.data],a.data.data.length<D&&(P.value=!0)):P.value=!0,b.value=!1})},E=e=>{if(P.value)return;let t=e.target;t.scrollTop+t.clientHeight>=t.scrollHeight&&(N.value++,H(k.value))},F=()=>{l.searchHistory=[]},z=e=>{const t=l.searchHistory.indexOf(e);l.searchHistory.splice(t,1)},O=async(e,t)=>{const{cover:a,name:r,singer:_,url:d,content:n}=await $(e);l.musicList.push({id:j(21),cover:a,name:r,singer:_,url:d,content:n}),l.playMusic(l.musicList.length-1)},R=async(e,t)=>{const{cover:a,name:r,singer:_,url:d,content:n}=await $(e);l.musicList.push({id:j(21),cover:a,name:r,singer:_,url:d,content:n})},T=async(e,t)=>{const{cover:a,name:r,singer:_,url:d,content:n}=await $(e);l.musicList.splice(l.activeIndex+1,0,{id:j(21),cover:a,name:r,singer:_,url:d,content:n})},U=async(e,t)=>{const{url:a}=await $(e);a&&oe(a)},$=async(e,t)=>{const a=new Promise((n,v)=>{x.get(`https://xiaoapi.cn/API/yy_sq.php?msg=${e.song}-${e.singer}&n=1`).then(u=>{u.data.code===200?n(u.data):n({})})}),r=new Promise((n,v)=>{x.get(`https://xiaoapi.cn/API/yy_sq.php?msg=${e.song} ${e.singer}&n=1`).then(u=>{u.data.code===200?n(u.data):n({})})}),_=new Promise((n,v)=>{x.get(`https://api.lolimi.cn/API/kggc/api.php?msg=${e.song} ${e.singer}&n=1`).then(u=>{u.data.code===1?n(u.data.data):n({})})}),d=await Promise.all([a,r,_]);return{...d[0],...d[1]}};return(e,t)=>{const a=p("a-input"),r=p("a-col"),_=p("a-button"),d=p("a-row"),n=p("a-empty"),v=p("a-menu-item"),u=p("a-menu"),V=p("a-dropdown"),Y=p("perfect-scrollbar"),G=p("a-spin");return f(),m("div",le,[s(d,{gutter:12},{default:c(()=>[s(r,{span:20},{default:c(()=>[s(a,{value:k.value,"onUpdate:value":t[0]||(t[0]=o=>k.value=o),onPressEnter:t[1]||(t[1]=o=>L(o.target.value)),placeholder:"输入歌曲、歌手",allowClear:"",style:{"border-radius":"16px"}},{prefix:c(()=>[s(y(J))]),_:1},8,["value"])]),_:1}),s(r,{span:3},{default:c(()=>[s(_,{type:"primary",shape:"round",onClick:t[2]||(t[2]=o=>L(k.value))},{default:c(()=>[I("搜索")]),_:1})]),_:1})]),_:1}),y(l).searchHistory.length?(f(),m("div",ie,[i("p",re,[I(" 搜索历史： "),i("span",{class:"clear",onClick:F},[s(y(K)),I("清空历史搜索")])]),i("div",de,[(f(!0),m(q,null,A(y(l).searchHistory,(o,h)=>(f(),m("p",{key:h,onClick:g=>H(o)},[i("span",pe,M(o),1),s(y(Z),{title:"点击移除",onClick:X(g=>z(o),["stop"])},null,8,["onClick"])],8,ue))),128))])])):B("",!0),i("div",_e,[he,s(G,{spinning:b.value,tip:"加载中..."},{default:c(()=>[s(Y,{class:"scroll-bar",onPsScrollY:E},{default:c(()=>[C.value.length?B("",!0):(f(),Q(n,{key:0})),i("ul",null,[(f(!0),m(q,null,A(C.value,(o,h)=>(f(),m("li",{key:h,onClick:g=>O(o,h)},[i("p",fe,M(o.song)+" - "+M(o.singers),1),i("div",ge,[s(V,{placement:"bottomLeft",arrow:""},{overlay:c(()=>[s(u,null,{default:c(()=>[s(v,null,{default:c(()=>[i("a",{href:"javascript:;",onClick:g=>R(o,h)},"添加到播放列表",8,me)]),_:2},1024),s(v,null,{default:c(()=>[i("a",{href:"javascript:;",onClick:g=>O(o,h)},"立即播放",8,ye)]),_:2},1024),s(v,null,{default:c(()=>[i("a",{href:"javascript:;",onClick:g=>T(o,h)},"下一首播放",8,ke)]),_:2},1024),s(v,null,{default:c(()=>[i("a",{href:"javascript:;",onClick:g=>U(o,h)},"下载",8,Ce)]),_:2},1024)]),_:2},1024)]),default:c(()=>[s(y(W))]),_:2},1024)])],8,ve))),128))])]),_:1})]),_:1},8,["spinning"])])])}}},xe=se(we,[["__scopeId","data-v-a53b8bd1"]]);export{xe as default};
