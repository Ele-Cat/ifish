import{l as se,m as ie,p as ue,a as k,q as le,s as ce,f as fe,x as L,y as ae,z as $,A as de}from"./index-e5d0d115.js";function R(e){return le()?(ce(e),!0):!1}function z(){const e=new Set,n=u=>{e.delete(u)};return{on:u=>{e.add(u);const o=()=>n(u);return R(o),{off:o}},off:n,trigger:u=>Promise.all(Array.from(e).map(o=>o(u)))}}function E(e){return typeof e=="function"?e():fe(e)}const X=typeof window<"u"&&typeof document<"u",pe=Object.prototype.toString,me=e=>pe.call(e)==="[object Object]",U=()=>{},he=ye();function ye(){var e;return X&&((e=window==null?void 0:window.navigator)==null?void 0:e.userAgent)&&/iP(ad|hone|od)/.test(window.navigator.userAgent)}function ne(e,n=!1,a="Timeout"){return new Promise((s,u)=>{setTimeout(n?()=>u(a):s,e)})}function ve(e,...n){return n.some(a=>a in e)}function J(...e){if(e.length!==1)return se(...e);const n=e[0];return typeof n=="function"?ie(ue(()=>({get:n,set:U}))):k(n)}function Q(e,n=!1){function a(r,{flush:t="sync",deep:i=!1,timeout:c,throwOnTimeout:O}={}){let v=null;const P=[new Promise(b=>{v=L(e,A=>{r(A)!==n&&(v==null||v(),b(A))},{flush:t,deep:i,immediate:!0})})];return c!=null&&P.push(ne(c,O).then(()=>E(e)).finally(()=>v==null?void 0:v())),Promise.race(P)}function s(r,t){if(!ae(r))return a(A=>A===r,t);const{flush:i="sync",deep:c=!1,timeout:O,throwOnTimeout:v}=t??{};let w=null;const b=[new Promise(A=>{w=L([e,r],([F,j])=>{n!==(F===j)&&(w==null||w(),A(F))},{flush:i,deep:c,immediate:!0})})];return O!=null&&b.push(ne(O,v).then(()=>E(e)).finally(()=>(w==null||w(),E(e)))),Promise.race(b)}function u(r){return a(t=>!!t,r)}function o(r){return s(null,r)}function l(r){return s(void 0,r)}function d(r){return a(Number.isNaN,r)}function h(r,t){return a(i=>{const c=Array.from(i);return c.includes(r)||c.includes(E(r))},t)}function y(r){return f(1,r)}function f(r=1,t){let i=-1;return a(()=>(i+=1,i>=r),t)}return Array.isArray(E(e))?{toMatch:a,toContains:h,changed:y,changedTimes:f,get not(){return Q(e,!n)}}:{toMatch:a,toBe:s,toBeTruthy:u,toBeNull:o,toBeNaN:d,toBeUndefined:l,changed:y,changedTimes:f,get not(){return Q(e,!n)}}}function ge(e){return Q(e)}function we(e,n,a={}){const{immediate:s=!0}=a,u=k(!1);let o=null;function l(){o&&(clearTimeout(o),o=null)}function d(){u.value=!1,l()}function h(...y){l(),u.value=!0,o=setTimeout(()=>{u.value=!1,o=null,e(...y)},E(n))}return s&&(u.value=!0,X&&h()),R(d),{isPending:ie(u),start:h,stop:d}}function _(e){var n;const a=E(e);return(n=a==null?void 0:a.$el)!=null?n:a}const Y=X?window:void 0;function V(...e){let n,a,s,u;if(typeof e[0]=="string"||Array.isArray(e[0])?([a,s,u]=e,n=Y):[n,a,s,u]=e,!n)return U;Array.isArray(a)||(a=[a]),Array.isArray(s)||(s=[s]);const o=[],l=()=>{o.forEach(f=>f()),o.length=0},d=(f,r,t,i)=>(f.addEventListener(r,t,i),()=>f.removeEventListener(r,t,i)),h=L(()=>[_(n),E(u)],([f,r])=>{if(l(),!f)return;const t=me(r)?{...r}:r;o.push(...a.flatMap(i=>s.map(c=>d(f,i,c,t))))},{immediate:!0,flush:"post"}),y=()=>{h(),l()};return R(y),y}let oe=!1;function be(e,n,a={}){const{window:s=Y,ignore:u=[],capture:o=!0,detectIframe:l=!1}=a;if(!s)return;he&&!oe&&(oe=!0,Array.from(s.document.body.children).forEach(t=>t.addEventListener("click",U)),s.document.documentElement.addEventListener("click",U));let d=!0;const h=t=>u.some(i=>{if(typeof i=="string")return Array.from(s.document.querySelectorAll(i)).some(c=>c===t.target||t.composedPath().includes(c));{const c=_(i);return c&&(t.target===c||t.composedPath().includes(c))}}),f=[V(s,"click",t=>{const i=_(e);if(!(!i||i===t.target||t.composedPath().includes(i))){if(t.detail===0&&(d=!h(t)),!d){d=!0;return}n(t)}},{passive:!0,capture:o}),V(s,"pointerdown",t=>{const i=_(e);i&&(d=!t.composedPath().includes(i)&&!h(t))},{passive:!0}),l&&V(s,"blur",t=>{setTimeout(()=>{var i;const c=_(e);((i=s.document.activeElement)==null?void 0:i.tagName)==="IFRAME"&&!(c!=null&&c.contains(s.document.activeElement))&&n(t)},0)})].filter(Boolean);return()=>f.forEach(t=>t())}const Te={json:"application/json",text:"text/plain"};function re(e){return e&&ve(e,"immediate","refetch","initialData","timeout","beforeFetch","afterFetch","onFetchError","fetch","updateDataOnError")}function K(e){return typeof Headers<"u"&&e instanceof Headers?Object.fromEntries([...e.entries()]):e}function Oe(e,...n){var a;const s=typeof AbortController=="function";let u={},o={immediate:!0,refetch:!1,timeout:0,updateDataOnError:!1};const l={method:"GET",type:"text",payload:void 0};n.length>0&&(re(n[0])?o={...o,...n[0]}:u=n[0]),n.length>1&&re(n[1])&&(o={...o,...n[1]});const{fetch:d=(a=Y)==null?void 0:a.fetch,initialData:h,timeout:y}=o,f=z(),r=z(),t=z(),i=k(!1),c=k(!1),O=k(!1),v=k(null),w=$(null),P=$(null),b=$(h||null),A=de(()=>s&&c.value);let F,j;const W=()=>{s&&(F==null||F.abort(),F=new AbortController,F.signal.onabort=()=>O.value=!0,u={...u,signal:F.signal})},q=p=>{c.value=p,i.value=!p};y&&(j=we(W,y,{immediate:!1}));const N=async(p=!1)=>{var T;W(),q(!0),P.value=null,v.value=null,O.value=!1;const g={method:l.method,headers:{}};if(l.payload){const M=K(g.headers),x=E(l.payload);!l.payloadType&&x&&Object.getPrototypeOf(x)===Object.prototype&&!(x instanceof FormData)&&(l.payloadType="json"),l.payloadType&&(M["Content-Type"]=(T=Te[l.payloadType])!=null?T:l.payloadType),g.body=l.payloadType==="json"?JSON.stringify(x):x}let B=!1;const S={url:E(e),options:{...g,...u},cancel:()=>{B=!0}};if(o.beforeFetch&&Object.assign(S,await o.beforeFetch(S)),B||!d)return q(!1),Promise.resolve(null);let C=null;return j&&j.start(),new Promise((M,x)=>{var ee;d(S.url,{...g,...S.options,headers:{...K(g.headers),...K((ee=S.options)==null?void 0:ee.headers)}}).then(async m=>{if(w.value=m,v.value=m.status,C=await m[l.type](),!m.ok)throw b.value=h||null,new Error(m.statusText);return o.afterFetch&&({data:C}=await o.afterFetch({data:C,response:m})),b.value=C,f.trigger(m),M(m)}).catch(async m=>{let te=m.message||m.name;return o.onFetchError&&({error:te,data:C}=await o.onFetchError({data:C,error:m,response:w.value})),P.value=te,o.updateDataOnError&&(b.value=C),r.trigger(m),p?x(m):M(null)}).finally(()=>{q(!1),j&&j.stop(),t.trigger(null)})})},Z=J(o.refetch);L([Z,J(e)],([p])=>p&&N(),{deep:!0});const H={isFinished:i,statusCode:v,response:w,error:P,data:b,isFetching:c,canAbort:A,aborted:O,abort:W,execute:N,onFetchResponse:f.on,onFetchError:r.on,onFetchFinally:t.on,get:D("GET"),put:D("PUT"),post:D("POST"),delete:D("DELETE"),patch:D("PATCH"),head:D("HEAD"),options:D("OPTIONS"),json:I("json"),text:I("text"),blob:I("blob"),arrayBuffer:I("arrayBuffer"),formData:I("formData")};function D(p){return(T,g)=>{if(!c.value)return l.method=p,l.payload=T,l.payloadType=g,ae(l.payload)&&L([Z,J(l.payload)],([B])=>B&&N(),{deep:!0}),{...H,then(B,S){return G().then(B,S)}}}}function G(){return new Promise((p,T)=>{ge(i).toBe(!0).then(()=>p(H)).catch(g=>T(g))})}function I(p){return()=>{if(!c.value)return l.type=p,{...H,then(T,g){return G().then(T,g)}}}}return o.immediate&&Promise.resolve().then(()=>N()),{...H,then(p,T){return G().then(p,T)}}}export{be as o,Oe as u};
