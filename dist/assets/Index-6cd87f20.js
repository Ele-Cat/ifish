import{e as x,f,o as z,q as l,w as S,I as M,J as h,r as j,h as F,i as J,p as G,v as K,s as C,u as i,j as r,L as Q,y as P,k as U}from"./index-dceb446a.js";import{_ as W,u as X,e as v,a as Y,g as Z}from"./App-c167c564.js";const ee=["src","loop"],te=["title"],se={__name:"Index",setup(ne){const{useMusicStore:e}=X(),V=x(()=>f(()=>import("./MusicCtrl-a2f25e67.js"),["assets/MusicCtrl-a2f25e67.js","assets/index-dceb446a.js","assets/index-c3c2086a.css","assets/App-c167c564.js","assets/App-e46b25bc.css","assets/VerticalRightOutlined-3f4b5ce4.js","assets/MusicCtrl-868ae43e.css"])),H=x(()=>f(()=>import("./MusicList-a8d84cb2.js"),["assets/MusicList-a8d84cb2.js","assets/index-dceb446a.js","assets/index-c3c2086a.css","assets/App-c167c564.js","assets/App-e46b25bc.css","assets/MusicList-58a3d6c8.css"])),$=x(()=>f(()=>import("./MusicSearch-61e4a1f9.js"),["assets/MusicSearch-61e4a1f9.js","assets/index-dceb446a.js","assets/index-c3c2086a.css","assets/App-c167c564.js","assets/App-e46b25bc.css","assets/MusicSearch-bf0fc1cc.css"])),R=x(()=>f(()=>import("./MusicFullScreen-afb0a6c3.js"),["assets/MusicFullScreen-afb0a6c3.js","assets/App-c167c564.js","assets/index-dceb446a.js","assets/index-c3c2086a.css","assets/App-e46b25bc.css","assets/VerticalRightOutlined-3f4b5ce4.js","assets/MusicFullScreen-a8801e23.css"]));z(()=>{e.settings.playing=!1,e.musicList&&e.musicList.map((t,s)=>{let u=new Audio(t.url);u.onerror=function(){k(t)},u.load()}),v.on("playOrPause",()=>{e.visible=!0,e.settings.playing?y():_()}),v.on("searchMusic",()=>{o.value=!0}),v.on("prevMusic",()=>{L()}),v.on("nextMusic",()=>{g()}),v.on("volChange",t=>{e.settings.volume+=t,e.settings.volume<0?e.settings.volume=0:e.settings.volume>100&&(e.settings.volume=100)})});const k=t=>{Y.get(`https://xiaoapi.cn/API/yy_sq.php?msg=${t.name} ${t.singer}&n=1`).then(s=>{const{code:u,url:p}=s.data;u===200&&(t.url=p)})},d=l(!1),o=l(!1),I=l(!1),n=l(null),T=l({});S(()=>[e.activeIndex,e.settings.playing],()=>{T.value=e.musicList[e.activeIndex]||{},M(()=>{n.value&&(c.value=parseInt(n.value.duration),n.value.volume=e.settings.volume/100,e.settings.playing&&n.value.play())})},{immediate:!0,deep:!0}),S(()=>[e.settings.volume,e.settings.mute],()=>{n.value&&M(()=>{n.value.volume=e.settings.volume/100,n.value.muted=e.settings.mute})},{immediate:!0,deep:!0});const m=l(0),c=l(1e3),A=()=>{c.value=parseInt(n.value.duration),m.value=n.value.currentTime=e.settings.currentTime},O=t=>{const{currentTime:s,duration:u}=t.target;m.value=e.settings.currentTime=parseInt(s),c.value=parseInt(u)},N=()=>{e.toggleVisible()},_=()=>{!e.musicList.length||e.activeIndex<0||(e.settings.playing=!0,n.value.play())},y=()=>{!e.musicList.length||e.activeIndex<0||(e.settings.playing=!1,n.value.pause())},b=h(()=>{if(!e.musicList.length||e.activeIndex<0)return"";let t=e.activeIndex===0?e.musicList.length-1:e.activeIndex-1;return e.musicList[t]?e.musicList[t].name:""}),L=()=>{if(!e.musicList.length||e.activeIndex<0)return;let t=e.activeIndex===0?e.musicList.length-1:e.activeIndex-1;e.playMusic(t)},D=h(()=>{if(!e.musicList.length||e.activeIndex<0)return"";let t=e.activeIndex===e.musicList.length-1?0:e.activeIndex+1;return e.musicList[t]?e.musicList[t].name:""}),g=()=>{if(!e.musicList.length||e.activeIndex<0)return;let t=e.activeIndex===e.musicList.length-1?0:e.activeIndex+1;e.playMusic(t)},B=()=>{e.settings.mode==="listCycle"?(e.musicList.length===1&&(e.activeIndex--,e.activeIndex++),g()):e.settings.mode==="singleCycle"?e.playMusic(e.activeIndex):e.settings.mode==="randomPlay"&&e.playMusic(Z(0,e.musicList.length-1,e.activeIndex))},q=()=>{console.log("播放出错")},E=t=>{e.settings.currentTime=t,n.value&&M(()=>{n.value.currentTime=t})},w=h(()=>({listCycle:"列表循环",singleCycle:"单曲循环",randomPlay:"随机播放"})[e.settings.mode]);return(t,s)=>{var p;const u=j("IDialog");return F(),J("div",{class:P(["music",[i(e).visible?"show":""]])},[G(C("audio",{ref_key:"audioRef",ref:n,controls:"",src:(p=T.value)==null?void 0:p.url,loop:i(e).settings.mode==="singleCycle",onTimeupdate:O,onLoadeddata:A,onEnded:B,onError:q},null,40,ee),[[K,!1]]),C("div",{class:P(["toggle-icon bf",[i(e).visible?"down":"up"]]),title:i(e).visible?"隐藏播放器":"显示播放器",onClick:N},[r(i(Q))],10,te),C("div",{class:P(["music-ctrl bf",[i(e).visible?"show":""]])},[r(i(V),{musicCurrentTime:m.value,musicDuration:c.value,prevMusic:b.value,nextMusic:D.value,musicMode:w.value,onShowSearch:s[0]||(s[0]=a=>o.value=!0),onToggleMusicList:s[1]||(s[1]=a=>d.value=!d.value),onShowLyric:s[2]||(s[2]=a=>I.value=!0),onHandlePlay:_,onHandlePause:y,onHandlePrev:L,onHandleNext:g,onHandleDurationChange:E},null,8,["musicCurrentTime","musicDuration","prevMusic","nextMusic","musicMode"])],2),r(i(H),{open:d.value,onShowSearch:s[3]||(s[3]=a=>o.value=!0),onClose:s[4]||(s[4]=a=>d.value=!1)},null,8,["open"]),r(u,{title:"搜索音乐",visible:o.value,zIndex:1002,onOk:s[5]||(s[5]=a=>o.value=!1),onCancel:s[6]||(s[6]=a=>o.value=!1)},{default:U(()=>[r(i($))]),_:1},8,["visible"]),r(i(R),{open:I.value,musicCurrentTime:m.value,musicDuration:c.value,prevMusic:b.value,nextMusic:D.value,musicMode:w.value,onClose:s[7]||(s[7]=a=>I.value=!1),onHandlePlay:_,onHandlePause:y,onHandlePrev:L,onHandleNext:g,onHandleDurationChange:E},null,8,["open","musicCurrentTime","musicDuration","prevMusic","nextMusic","musicMode"])],2)}}},ae=W(se,[["__scopeId","data-v-566b6336"]]);export{ae as default};
