import{q as C,r as p,h as f,i as m,j as a,k as c,u as y,S as J,z as j,s as i,T as K,F as A,t as B,D,C as Q,B as H,U as W,l as X,V as Z,M as ee,N as te}from"./index-041dbff2.js";import{_ as ae,u as se,t as ne,a as x,b as I,d as oe}from"./App-66c9583b.js";const ce=S=>(ee("data-v-d6685da0"),S=S(),te(),S),le={class:"search"},ie={key:0,class:"search-history"},re={class:"title"},de={class:"search-history-box"},ue=["onClick"],pe={class:"text",title:"点击搜索"},_e={class:"search-list"},he=ce(()=>i("p",{class:"title"},"搜索结果：",-1)),ve=["onClick"],fe={title:"立即播放"},ge={class:"search-action"},me=["onClick"],ye=["onClick"],ke=["onClick"],we=["onClick"],q=15,Ce={__name:"MusicSearch",setup(S){const{useMusicStore:l}=se(),k=C(""),w=C([]),P=C(!1),M=e=>{if(w.value=[],!e){ne({type:"warning",content:"请输入歌曲、歌手后搜索"});return}l.searchHistory.indexOf(e)<0&&l.searchHistory.unshift(e),b(e)};let L=C(1),N=C(!1);const b=e=>{k.value=e,P.value=!0;const t=`http://www.dreamling.top/API/kugou/android_lite/music/api.php?keyword=${e}&page=${L.value}&pagenum=${q}&format=json`;x.get(t).then(s=>{s.data.code===1?(w.value=[...w.value,...s.data.data],s.data.data.length<q&&(N.value=!0)):N.value=!0,P.value=!1})},E=e=>{if(N.value)return;let t=e.target;t.scrollTop+t.clientHeight>=t.scrollHeight&&(L.value++,b(k.value))},F=()=>{l.searchHistory=[]},z=e=>{const t=l.searchHistory.indexOf(e);l.searchHistory.splice(t,1)},O=async(e,t)=>{const{cover:s,name:r,singer:_,url:d,content:n}=await $(e);l.musicList.push({id:I(21),cover:s,name:r,singer:_,url:d,content:n}),l.playMusic(l.musicList.length-1)},R=async(e,t)=>{const{cover:s,name:r,singer:_,url:d,content:n}=await $(e);l.musicList.push({id:I(21),cover:s,name:r,singer:_,url:d,content:n})},T=async(e,t)=>{const{cover:s,name:r,singer:_,url:d,content:n}=await $(e);l.musicList.splice(l.activeIndex+1,0,{id:I(21),cover:s,name:r,singer:_,url:d,content:n})},U=async(e,t)=>{const{url:s}=await $(e);s&&oe(s)},$=async(e,t)=>{const s=new Promise((n,v)=>{x.get(`https://xiaoapi.cn/API/yy_sq.php?msg=${e.song}-${e.singer}&n=1`).then(u=>{u.data.code===200?n(u.data):n({})})}),r=new Promise((n,v)=>{x.get(`https://xiaoapi.cn/API/yy_sq.php?msg=${e.song} ${e.singer}&n=1`).then(u=>{u.data.code===200?n(u.data):n({})})}),_=new Promise((n,v)=>{x.get(`https://api.lolimi.cn/API/kggc/api.php?msg=${e.song} ${e.singer}&n=1`).then(u=>{u.data.code===1?n(u.data.data):n({})})}),d=await Promise.all([s,r,_]);return{...d[0],...d[1]}};return(e,t)=>{const s=p("a-input"),r=p("a-col"),_=p("a-button"),d=p("a-row"),n=p("a-empty"),v=p("a-menu-item"),u=p("a-menu"),V=p("a-dropdown"),Y=p("perfect-scrollbar"),G=p("a-spin");return f(),m("div",le,[a(d,{gutter:12},{default:c(()=>[a(r,{span:20},{default:c(()=>[a(s,{value:k.value,"onUpdate:value":t[0]||(t[0]=o=>k.value=o),onPressEnter:t[1]||(t[1]=o=>M(o.target.value)),placeholder:"输入歌曲、歌手",allowClear:"",style:{"border-radius":"16px"}},{prefix:c(()=>[a(y(J))]),_:1},8,["value"])]),_:1}),a(r,{span:3},{default:c(()=>[a(_,{type:"primary",shape:"round",onClick:t[2]||(t[2]=o=>M(k.value))},{default:c(()=>[j("搜索")]),_:1})]),_:1})]),_:1}),y(l).searchHistory.length?(f(),m("div",ie,[i("p",re,[j(" 搜索历史： "),i("span",{class:"clear",onClick:F},[a(y(K)),j("清空历史搜索")])]),i("div",de,[(f(!0),m(A,null,B(y(l).searchHistory,(o,h)=>(f(),m("p",{key:h,onClick:g=>b(o)},[i("span",pe,H(o),1),a(y(Z),{title:"点击移除",onClick:X(g=>z(o),["stop"])},null,8,["onClick"])],8,ue))),128))])])):D("",!0),i("div",_e,[he,a(G,{spinning:P.value,tip:"加载中..."},{default:c(()=>[a(Y,{class:"scroll-bar",onPsScrollY:E},{default:c(()=>[w.value.length?D("",!0):(f(),Q(n,{key:0})),i("ul",null,[(f(!0),m(A,null,B(w.value,(o,h)=>(f(),m("li",{key:h,onClick:g=>O(o,h)},[i("p",fe,H(o.SongName)+" - "+H(o.SingerName),1),i("div",ge,[a(V,{placement:"bottomLeft",arrow:""},{overlay:c(()=>[a(u,null,{default:c(()=>[a(v,null,{default:c(()=>[i("a",{href:"javascript:;",onClick:g=>R(o,h)},"添加到播放列表",8,me)]),_:2},1024),a(v,null,{default:c(()=>[i("a",{href:"javascript:;",onClick:g=>O(o,h)},"立即播放",8,ye)]),_:2},1024),a(v,null,{default:c(()=>[i("a",{href:"javascript:;",onClick:g=>T(o,h)},"下一首播放",8,ke)]),_:2},1024),a(v,null,{default:c(()=>[i("a",{href:"javascript:;",onClick:g=>U(o,h)},"下载",8,we)]),_:2},1024)]),_:2},1024)]),default:c(()=>[a(y(W))]),_:2},1024)])],8,ve))),128))])]),_:1})]),_:1},8,["spinning"])])])}}},xe=ae(Ce,[["__scopeId","data-v-d6685da0"]]);export{xe as default};
